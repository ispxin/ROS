define("build/ros/1.0.0/run",["./global","jquery","./cookie","./login","./desk","./user","./popupmenu","./debounce","./dialog","./drag","./task"],function(a){window.GLOBAL=a("./global"),window.$=a("jquery"),a("./cookie")($),window.login=a("./login"),a("./desk").init()}),define("build/ros/1.0.0/global",[],{version:"v1.0",validDate:365,sortType:"y",tpl:{}}),define("build/ros/1.0.0/cookie",["jquery"],function(a){a("jquery");return function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{a=decodeURIComponent(a.replace(g," "))}catch(b){return}try{return h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setDate(k.getDate()+j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0!==a.cookie(b)?(a.cookie(b,"",a.extend({},c,{expires:-1})),!0):!1}}}),define("build/ros/1.0.0/login",[],function(a,b,c){var d='<div class="close" title="关闭" id="login-close"></div><div class="form-wraper"><form class="form" id="signin"><div class="header">ROS</div><div class="item"><input type="text" class="input" placeholder="账号" id="user" name="user" /><div class="message" id="message-user"></div></div><div class="item"><input type="password" class="input" placeholder="密码" id="password" name="password" /><div class="message" id="message-password"></div></div><div class="item"><button type="button" class="button" id="btn-login">登 录</button></div><div class="item"><div class="register-text clearfix"><span class="fl">我还没有账号，<a href="javascript:;" id="go-register">十秒钟注册</a></span><span class="fr"><a href="#">忘记密码？</a></span></div></div></form><form class="form" id="register"><div class="item"><input type="text" class="input" placeholder="E-mail" id="reg-user" name="user" /><div class="message" id="message-reg-user"></div></div><div class="item"><input type="password" class="input" placeholder="输入密码" id="reg-password" name="password" /><div class="message" id="message-reg-password"></div></div><div class="item"><input type="password" class="input" placeholder="确认密码" id="reg-password-repeat" name="passwordRepeat" /><div class="message" id="message-reg-password-repeat"></div></div><div class="item"><button type="button" class="button" id="btn-register">注 册</button></div><div class="item"><div class="register-text clearfix"><span class="fl">我已经有账号了，<a href="javascript:;" id="go-signin">马上登录</a></span><span class="fr"><a href="#">忘记密码？</a></span></div></div></form></div>',e={open:function(){this.create(),this.bind()},create:function(){this.login=$("<div>",{"class":"login",id:"login"}).html(d).appendTo("body"),this.mask=$("<div>",{"class":"mask"}).appendTo("body");var a=$.cookie("ROS_username");a?($("#user").val(a),$("#password").focus()):$("#user").focus(),$(this.login).animate({top:"50%"},400),$(this.mask).animate({opacity:.3},400)},close:function(){$(this.login).animate({top:-300},400,function(){$(this).remove()}),$(this.mask).animate({opacity:0},400,function(){$(this).remove()})},change:function(a){var b=$("#signin"),c=$("#register");"register"==a?(b.animate({left:-330,opacity:0},300),c.animate({left:0,opacity:1},300)):"signin"==a&&(b.animate({left:0,opacity:1},300),c.animate({left:330,opacity:0},300))},checkUser:function(){var a=$("#user"),b=a.next(),c=a.val(),d=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return c?d.test(c)?(b.html("").parent().removeClass("error"),!0):(b.html("请输入E-mail格式").parent().addClass("error"),!1):(b.html("请输入账号").parent().addClass("error"),!1)},checkPassword:function(){var a=$("#password"),b=a.next(),c=a.val();return c?(b.html("").parent().removeClass("error"),!0):(b.html("请输入密码").parent().addClass("error"),!1)},checkLogin:function(){var a=this,b=$("#message-user"),c=$("#message-password"),d=$("#signin").serialize(),e=a.checkUser();if(!e)return $("#user").focus(),this.waggle(),!1;var f=a.checkPassword();return f?($.ajax({url:CONFIG.WEBURL+"index.php/User/signin",data:d,type:"post",success:function(d){1==d.status?location.reload():0==d.status&&(0==d.data?(b.html("账号不存在").parent().addClass("error"),a.waggle()):1==d.data&&(c.html("密码错误").parent().addClass("error"),a.waggle()))}}),void 0):($("#password").focus(),this.waggle(),!1)},checkRegUser:function(){var a=$("#reg-user"),b=a.next(),c=a.val(),d=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return c?d.test(c)?(b.html("").parent().removeClass("error"),!0):(b.html("E-mail格式不正确").parent().addClass("error"),!1):(b.html("请输入E-mail").parent().addClass("error"),!1)},checkRegPassword:function(){var a=$("#reg-password"),b=a.next(),c=a.val();return c?(b.html("").parent().removeClass("error"),!0):(b.html("请输入密码").parent().addClass("error"),!1)},checkRegPasswordRepeat:function(){var a=$("#reg-password-repeat"),b=a.next(),c=a.val();return c?(b.html("").parent().removeClass("error"),!0):(b.html("请输入确认密码").parent().addClass("error"),!1)},checkPasswordSame:function(){var a=$("#reg-password"),b=$("#reg-password-repeat"),c=a.val(),d=b.val(),e=b.next();return c!=d?(e.html("密码不一致").parent().addClass("error"),!1):!0},checkRegister:function(){var a=this,b=$("#message-reg-user"),c=($("#message-reg-password"),$("#message-reg-password-repeat")),d=$("#register").serialize(),e=a.checkRegUser();if(!e)return $("#reg-user").focus(),this.waggle(),!1;var f=a.checkRegPassword();if(!f)return $("#reg-password").focus(),this.waggle(),!1;var g=a.checkRegPasswordRepeat();if(!g)return $("#reg-password-repeat").focus(),this.waggle(),!1;var h=a.checkPasswordSame();return h?($.ajax({url:CONFIG.WEBURL+"index.php/User/register",data:d,type:"post",success:function(d){1==d.status?($("#register input").val(""),a.change("signin"),$("#user").val(d.data.user),$("#password").focus()):0==d.status&&(1==d.data?(b.html("E-mail已被注册").parent().addClass("error"),a.waggle()):2==d.data&&(c.html("E-密码不一致").parent().addClass("error"),a.waggle()))}}),void 0):($("#reg-password-repeat").focus(),this.waggle(),!1)},waggle:function(){var a=0,b=null,c=[-155,-145,-154,-146,-153,-147,-152,-148,-151,-149,-150];clearInterval(b),b=setInterval(function(){$("#login").css("margin-left",c[a]),a++,a==c.length&&clearInterval(b)},30)},bind:function(){var a=this;$("#login-close").on("click",function(){a.close()}),$("#go-register").on("click",function(){a.change("register")}),$("#go-signin").on("click",function(){a.change("signin")}),$("#user").on("blur",this.checkUser),$("#password").on("blur",this.checkPassword),$("#btn-login").on("click",function(){a.checkLogin()}),$("#user, #password").on("keydown",function(b){13==b.keyCode&&a.checkLogin()}),$("#reg-user").on("blur",this.checkRegUser),$("#reg-password").on("blur",this.checkRegPassword),$("#reg-password-repeat").on("blur",this.checkRegPasswordRepeat),$("#btn-register").on("click",function(){a.checkRegister()})}};c.exports={open:function(){e.open()}}}),define("build/ros/1.0.0/desk",["build/ros/1.0.0/user","build/ros/1.0.0/popupmenu","build/ros/1.0.0/login","build/ros/1.0.0/debounce","build/ros/1.0.0/dialog","build/ros/1.0.0/drag","build/ros/1.0.0/task"],function(a,b,c){var d=a("build/ros/1.0.0/user"),e=a("build/ros/1.0.0/popupmenu"),f=a("build/ros/1.0.0/debounce"),g=a("build/ros/1.0.0/dialog"),h=(a("build/ros/1.0.0/task"),$(window)),i=$(document),j=$("body"),k={init:function(){$.cookie("ROS_desk",1),$.cookie("ROS_sortType")?this.sortType=$.cookie("ROS_sortType"):(this.sortType=GLOBAL.sortType,$.cookie("ROS_sortType",GLOBAL.sortType,{expires:GLOBAL.validDate})),this.iNow=0,this.oDesk=$("#desk"),this.oDeskContent=$("#desk-content"),this.oNavbar=$("#navbar"),this.oIndicator=$("#indicator"),this.aIndicator=this.oIndicator.children(),this.getApp(),this.setDesk(),this.setNavbar(),this.setAppSort(this.sortType),this.resizeDesk(),this.bind()},setDesk:function(){this.iWidth=h.width()-240,this.iHeight=h.height()-160,this.iLeft=h.width()-120,this.oDeskContent.css({width:this.iWidth,height:this.iHeight});for(var a=0;a<this.aAppContent.length;a++)a!=this.iNow?this.aAppContent.eq(a).css({width:this.iWidth,height:this.iHeight,left:-this.iLeft}):this.aAppContent.eq(a).css({width:this.iWidth,height:this.iHeight,left:0})},getApp:function(){var a=this;$.ajax({url:CONFIG.WEBURL+"index.php/Index/getApp",type:"get",async:!1}).done(function(b){var c=a.createAppHtml(b.data);a.oDeskContent.append(c),a.aAppContent=a.oDeskContent.children()})},createAppHtml:function(a){var b="";return $.each(a,function(c){b+='<ul class="app-content">',$.each(a[c],function(d){var e=a[c][d];null!==e&&(b+='<li title="'+e.title+'" class="app-item" data-id="'+e.id+'" data-index="'+d+'" data-type="'+e.type+'" data-title="'+e.title+'" data-icon="'+e.icon+'" data-url="'+e.url+'" data-width="'+e.width+'" data-height="'+e.height+'" data-ismax="'+e.isMax+'"><div class="app-icon"><img src="'+e.icon+'"></div><div class="app-name"><span><i>'+e.title+"</i></span></div></li>")}),b+='<li class="app-item" data-type="add"><div class="app-icon"><span class="app-add"></span></div><div class="app-name"><span><i>添加应用</i></span></div></li></ul>'}),b},setNavbar:function(){this.oNavbar.css({left:(h.width()-240)/2,top:10,display:"block"})},indicator:function(a){var b=a.index();a.addClass("active").siblings().removeClass("active"),b>this.iNow?(this.aAppContent.eq(b).css("left",-this.iWidth),this.aAppContent.eq(this.iNow).stop().animate({left:this.iLeft,opacity:0},600)):b<this.iNow&&(this.aAppContent.eq(b).css("left",this.iWidth),this.aAppContent.eq(this.iNow).stop().animate({left:-this.iLeft,opacity:0},600)),this.aAppContent.eq(b).stop().animate({left:0,opacity:1},600),this.iNow=b,$.cookie("ROS_desk",++b)},setAppY:function(){var a=this.oDeskContent.children(),b=120,c=Math.floor(this.oDeskContent.height()/b);0==c&&(c=1),a.each(function(d){var e=a.eq(d).children();e.each(function(a){var d=b*Math.floor(a/c),f=b*(a%c);e.eq(a).animate({left:d,top:f},700)})})},setAppX:function(){var a=this.oDeskContent.children(),b=120,c=Math.floor(this.oDeskContent.width()/b);a.each(function(d){var e=a.eq(d).children();e.each(function(a){var d=b*Math.floor(a/c),f=b*(a%c);e.eq(a).animate({left:f,top:d},700)})})},setAppSort:function(a){$.cookie("ROS_sortType",a,{expires:GLOBAL.validDate}),"x"==a?this.setAppX():"y"==a&&this.setAppY()},bump:function(a,b){var c=a.offset().left,d=a.offset().top,e=a.offset().left+a.outerWidth(),f=a.offset().top+a.outerHeight(),g=b.offset().left,h=b.offset().top,i=b.offset().left+b.outerWidth(),j=b.offset().top+b.outerHeight();return e>=g&&i>=c&&f>=h&&j>=d?!0:!1},jl:function(a,b){var c=a.offset().left-b.offset().left,d=a.offset().top-b.offset().top;return Math.sqrt(Math.pow(c,2)+Math.pow(d,2))},appNear:function(a){var b=this,c=a.parent().children(),d=9999,e=-1,f=a.index();return c.each(function(g){if(g!=f&&b.bump(a,c.eq(g))){var h=b.jl(a,c.eq(g));d>h&&(d=h,e=g)}}),-1==e?!1:c.eq(e)},appMove:function(){},resizeDesk:function(){var a=f(this,this.setDesk,100),b=f(this,this.setAppX,100),c=f(this,this.setAppY,100);h.on("resize",function(){a(),"x"==$.cookie("ROS_sortType")?b():"y"==$.cookie("ROS_sortType")&&c()})},appOpen:function(a){var b=a.data();$.ros.dialog({id:b.id,icon:b.icon,title:b.title,url:b.url,width:b.width,height:b.height,isMax:b.ismax})},appDel:function(a){var b=this,c={appid:a.data("id"),type:1};$.ajax({url:CONFIG.WEBURL+"index.php/App/delApp",type:"post",data:c,success:function(c){1==c.status&&(a.remove(),b.setAppSort($.cookie("ROS_sortType")))}})},appMoveDesk:function(a,b){var c=this,d={appid:a.data("id"),desk:b+1,type:1};$.ajax({url:CONFIG.WEBURL+"index.php/App/moveDeskApp",type:"post",data:d,success:function(d){if(1==d.status){var e=c.oDeskContent.children().eq(b).children().eq(-1);$(e).before(a),c.setAppSort($.cookie("ROS_sortType"))}}})},appAdd:function(){$.ros.dialog({id:"add",icon:"/ros/Public/Home/images/app/app-add.png",title:"应用市场",url:"./index.php/App",width:800,height:500,isMax:!1})},lockDesk:function(){var a=this,b=$("#wallpaper img").attr("src"),c=$.cookie("ROS_username"),e='<div class="lock-desk" id="lock-desk"><div class="lock-desk-avatar"><img src="/ros/Public/Home/images/desktop/avatar.gif" /></div><div class="lock-desk-user">'+c+'</div><div class="lock-desk-form"><input type="hidden" name="user" id="user" value="'+c+'" /><input type="password" class="lock-desk-input" name="password" id="password" /><div class="lock-desk-enter" title="进入" id="enterDesk"></div></div></div><div style="position:absolute; left:0; top:0; width:100%; height:100%; z-index:1;"></div><img src="'+b+'" style="position:absolute; left:0; top:0; z-index:0; width:100%; height:100%;">';this.oLock=$("<div>").css({display:"none",position:"absolute",left:0,top:0,width:"100%",height:"100%",zIndex:9999}).html(e).appendTo("body"),$("#enterDesk").on("click",function(){var b={user:$("#user").val(),password:$("#password").val()};a.unlockDesk(b)}),$("#password").on("keyup",function(b){if($(this).val()?$(this).next().show():$(this).next().hide(),13==b.keyCode){if(!$(this).val())return a.lockWaggle(),void 0;var c={user:$("#user").val(),password:$("#password").val()};a.unlockDesk(c)}}),d.lock().done(function(){a.oLock.fadeIn(600),$("#password").focus()}),i.on("click.lockFocus",function(){$("#password").focus()})},unlockDesk:function(a){var b=this;$.ajax({url:CONFIG.WEBURL+"index.php/User/signin",type:"post",data:a,success:function(a){1==a.status?b.oLock.fadeOut(300,function(){$(this).remove(),i.off("click.lockFocus")}):0==a.status&&(b.lockWaggle(),$("#password").focus())}})},lockWaggle:function(){var a=0,b=null,c=[-116,-106,-115,-107,-114,-108,-113,-109,-112,-110,-111];clearInterval(b),b=setInterval(function(){$("#lock-desk").css("margin-left",c[a]),a++,a==c.length&&clearInterval(b)},30)},userSetting:function(){$.ros.dialog({id:"userSetting",icon:"/ros/Public/Home/images/app/user.png",title:"账号设置",url:"",width:500,height:400,isMax:!1})},bind:function(){var a=this;j.on("click",function(){$(".contextmenu").hide()}),j.on("contextmenu",function(){return!1}),this.oDesk.on("contextmenu",function(b){var c=e.contextmenu(a,g);return $(".contextmenu").hide(),e.show(b,c),!1}),this.oDeskContent.on("contextmenu",'li[data-type="app"]',function(b){var c=e.appmenu(a,$(this));return $(".contextmenu").hide(),e.show(b,c),!1}),$.ros.drag(!0,this.oNavbar),this.aIndicator.on("click",function(){a.indicator($(this))}),$("#navbar-avatar").on("click",function(){d.checkLogin()?a.userSetting():login.open()}),this.oDeskContent.on("click",'li[data-type="add"]',function(){a.appAdd()}),this.oDeskContent.on("click",'li[data-type="app"]',function(){a.appOpen($(this))}),$("#loading").fadeOut(500)}};c.exports={init:function(){k.init()},lockDesk:function(){k.lockDesk()},setAppSort:function(a){k.setAppSort(a)},appOpen:function(a){k.appOpen(a)},appDel:function(a){k.appDel(a)},appAdd:function(){k.appAdd()}}}),define("build/ros/1.0.0/user",[],function(){var a={checkLogin:function(){var a=!1,b=$.cookie("ROS_status");return 1==b&&(a=!0),a},logout:function(){$.getJSON("./index.php/User/logout",function(a){1==a.status&&location.reload()})},lock:function(){return $.ajax({url:"./index.php/User/logout",type:"get"})}};return a}),define("build/ros/1.0.0/popupmenu",["build/ros/1.0.0/user","build/ros/1.0.0/login"],function(a){var b=$(document),c=a("build/ros/1.0.0/user"),d=a("build/ros/1.0.0/login"),e={contextmenu:function(a,b){var e=c.checkLogin(),f='<div class="contextmenu-style"><ul class="contextmenu-ul"><li class="contextmenu-li"><a href="javascript:;" class="contextmenu-a" id="mShowDesk">显示桌面</a></li><li class="contextmenu-li"><a href="javascript:;" class="contextmenu-a" id="mCloseAllApp">关闭所有窗口</a></li><li class="contextmenu-li"><span class="line"></span></li><li class="contextmenu-li contextsubmenu"><a href="#" class="contextmenu-a">添加<span class="icon-arrow"></span></a><div class="contextsubmenu-wrap"><ul class="contextsubmenu-ul contextmenu-style"><li class="contextsubmenu-li"><a href="#" class="contextsubmenu-a" id="mAppAdd">添加应用<span class="icon icon-app"></span></a></li><li class="contextsubmenu-li"><a href="#" class="contextsubmenu-a">新建文件夹<span class="icon icon-folder"></span></a></li></ul></div></li><li class="contextmenu-li"><span class="line"></span></li><li class="contextmenu-li"><a href="#" class="contextmenu-a">更换壁纸</a></li><li class="contextmenu-li"><a href="#" class="contextmenu-a">系统设置</a></li><li class="contextmenu-li contextsubmenu"><a href="#" class="contextmenu-a">排序方式<span class="icon-arrow"></span></a><div class="contextsubmenu-wrap"><ul class="contextsubmenu-ul contextmenu-style"><li class="contextsubmenu-li"><a href="javascript:;" class="contextsubmenu-a '+("x"==$.cookie("ROS_sortType")?"on":"")+' " id="mSetAppX">横向排列<span class="icon icon-current"></span></a></li><li class="contextsubmenu-li"><a href="javascript:;" class="contextsubmenu-a '+("y"==$.cookie("ROS_sortType")?"on":"")+' " id="mSetAppY">纵向排列<span class="icon icon-current"></span></a></li></ul></div></li><li class="contextmenu-li"><span class="line"></span></li>'+(e?'<li class="contextmenu-li"><a href="javascript:;" class="contextmenu-a" id="mLockDesk">锁定</a></li>':"")+(e?'<li class="contextmenu-li"><a href="javascript:;" class="contextmenu-a" id="mLogout">注销</a></li>':"")+(e?"":'<li class="contextmenu-li"><a href="javascript:;" class="contextmenu-a" id="mLogin">登录</a></li>')+"</ul></div>";return GLOBAL.tpl.contextmenu||(GLOBAL.tpl.contextmenu=$('<div class="contextmenu"></div>').html(f).appendTo("body"),$("#mSetAppX").on("click",function(){a.setAppSort("x"),$(this).parent().parent().find("a").removeClass("on"),$(this).addClass("on")}),$("#mSetAppY").on("click",function(){a.setAppSort("y"),$(this).parent().parent().find("a").removeClass("on"),$(this).addClass("on")}),$("#mShowDesk").on("click",function(){$.isEmptyObject(b.dialogList)||$.each(b.dialogList,function(a,b){b.hide()})}),$("#mCloseAllApp").on("click",function(){$.isEmptyObject(b.dialogList)||$.each(b.dialogList,function(a,b){b.remove()})}),$("#mAppAdd").on("click",function(){a.appAdd()}),$("#mLockDesk").on("click",function(){a.lockDesk()}),$("#mLogout").on("click",function(){c.logout()}),$("#mLogin").on("click",function(){d.open()})),GLOBAL.tpl.contextmenu},appmenu:function(a,b){var c='<div class="contextmenu-style"><ul class="contextmenu-ul"><li class="contextmenu-li"><a class="contextmenu-a" href="javascript:;" id="mAppOpen">打开应用</a></li><li class="contextmenu-li"><span class="line"></span></li><li class="contextmenu-li contextsubmenu"><a class="contextmenu-a" href="#">移动应用到<span class="icon-arrow"></span></a><div class="contextsubmenu-wrap"><ul class="contextsubmenu-ul contextmenu-style" id="mScreenMove"><li class="contextsubmenu-li"><a class="contextsubmenu-a" href="javascript:;" data-desk="0">桌面1</a></li><li class="contextsubmenu-li"><a class="contextsubmenu-a" href="javascript:;" data-desk="1">桌面2</a></li><li class="contextsubmenu-li"><a class="contextsubmenu-a" href="javascript:;" data-desk="2">桌面3</a></li><li class="contextsubmenu-li"><a class="contextsubmenu-a" href="javascript:;" data-desk="3">桌面4</a></li><li class="contextsubmenu-li"><a class="contextsubmenu-a" href="javascript:;" data-desk="4">桌面5</a></li></ul></div></li><li class="contextmenu-li"><a class="contextmenu-a" href="javascript:;" id="mAppDel">卸载应用</a></li></ul></div>';return GLOBAL.tpl.appmenu||(GLOBAL.tpl.appmenu=$('<div class="contextmenu"></div>').html(c).appendTo("body")),$("#mAppOpen").off("click").on("click",function(){a.appOpen(b)}),$("#mAppDel").off("click").on("click",function(){a.appDel(b)}),$("#mScreenMove li").each(function(a){a==$.cookie("ROS_desk")-1?$(this).find("a").addClass("disabled"):$(this).find("a").removeClass("disabled")}),$("#mScreenMove").off("click").on("click","a:not(.disabled)",function(){var c=$(this).data("desk");a.appMoveDesk(b,c)}),GLOBAL.tpl.appmenu},taskmenu:function(a){var b='<div class="contextmenu-style"><ul class="contextmenu-ul"><li class="contextmenu-li"><a class="contextmenu-a" href="javascript:;" id="mMinDialog">最小化</a></li><li class="contextmenu-li"><a class="contextmenu-a" href="javascript:;" id="mMaxresDialog">最大化</a></li><li class="contextmenu-li"><span class="line"></span></li><li class="contextmenu-li"><a class="contextmenu-a" href="javascript:;" id="mCloseDialog">关闭窗口</a></li></ul></div>';GLOBAL.tpl.menu||(GLOBAL.tpl.menu=$('<div class="contextmenu"></div>').html(b).appendTo("body"));var c=$("#mMaxresDialog"),d=$("#mMinDialog");return a.o.isMax?(c.html(a.maxed?"还原":"最大化"),c.off("click").on("click",function(){a.maxres()}),c.parent().show()):c.parent().hide(),d.html(a.opened?"最小化":"打开"),d.off("click").on("click",function(){a.opened?a.hide():a.show()}),$("#mCloseDialog").off("click").on("click",function(){a.remove()}),GLOBAL.tpl.menu},show:function(a,c){var d=c.outerWidth(),e=c.outerHeight(),f=a.clientX,g=a.clientY,h=b.width()-d,i=b.height()-e;f>h?c.css("left",f-d):c.css("left",f),g>i?c.css("top",g-e):c.css("top",g),c.fadeIn(100)}};return e}),define("build/ros/1.0.0/debounce",[],function(){return function(a,b,c,d){var e,f;return function(){var g=a,h=arguments,i=function(){e=null,d||(f=b.apply(g,h))},j=d&&!e;return clearTimeout(e),e=setTimeout(i,c),j&&(f=b.apply(g,h)),f}}}),define("build/ros/1.0.0/dialog",["build/ros/1.0.0/drag","build/ros/1.0.0/task","build/ros/1.0.0/popupmenu","build/ros/1.0.0/user","build/ros/1.0.0/login"],function(a,b,c){function d(a){var b=this;this.opened=!1,this.maxed=!1,this.o=$.extend({},h,a);var c=this.__isCreate(this.o.id);if(c){var d=g[this.o.id];return d.opened||(d.show(),d.__task.setActive()),d.zIndexUp(),void 0}this.__init(),this.__center(),this.__$("close").on("click",function(){b.close()}),e.on("resize",function(){b.__resize()}),this.o.isMin&&this.__$("min").on("click",function(){b.hide()}),this.o.isMax&&this.__$("maxres").on("click",function(){b.maxres($(this))}),this.o.isDrag&&($.ros.drag(!1,this.__$("title"),this.__dialog),this.__$("title").on("mousedown",function(){b.zIndexUp(),b.__task.setActive();var a=$('<div class="iframeMask"></div>').appendTo(b.__$("content"));f.on("mouseup",function(){a.remove()})})),this.show(),this.__openTask()}a("build/ros/1.0.0/drag"),a("build/ros/1.0.0/task");var e=$(window),f=$(document),g={},h={icon:null,title:"",url:"",width:300,height:200,isDrag:1,isMin:1,isMax:1};d.prototype={__init:function(){this.__dialog=$("<div>").css({display:"none",position:"absolute",left:0,top:0,bottom:"auto",right:"auto",zIndex:d.zIndex,margin:0,padding:0,outline:0,border:"0 none",background:"transparent"}).html(this.__createTmplate()).appendTo($("#desk-dialog")),g[this.o.id]=this},show:function(){this.__dialog.show(),this.zIndexUp(),this.opened=!0},hide:function(){this.__dialog.hide(),this.__task.cancelActive(),this.opened=!1},toggle:function(){var a=this.__getDialogCount();a>1?(this.show(),this.__task.setActive()):1==a&&(this.opened?this.hide():(this.show(),this.__task.setActive()))},maxres:function(){this.maxed?this.__restore():this.__maximize()},close:function(){var a=this;this.__dialog.animate({left:e.width(),top:0,width:0,height:0,opacity:0},500,function(){a.remove()})},remove:function(){delete g[this.o.id],this.__task.close(),this.__dialog.remove()},zIndexUp:function(){var a=++d.zIndex;this.__dialog.css("zIndex",a)},__isCreate:function(a){var b=!1;return $.each(g,function(c){a==c&&(b=!0)}),b},__processUrl:function(){return'<iframe i="iframe" name="dialog-'+this.o.id+'" src="'+this.o.url+'" frameborder="no" allowtransparency="true" scrolling="auto" width="'+this.o.width+'" height="'+this.o.height+'"></iframe>'},__createTmplate:function(){var a='<div i="dialog" class="dialog"><div i="head" class="dialog-head">'+(this.o.icon?'<div class="dialog-logo"><img src="'+this.o.icon+'" class="dialog-logo-icon" /></div>':"")+'<div i="title" class="dialog-title">'+(this.o.title?this.o.title:"")+'</div><div class="dialog-handle">'+(this.o.isMin?'<span i="min" class="dialog-minimize" title="最小化"></span>':"")+(this.o.isMax?'<span i="maxres" class="dialog-maxres dialog-maximize" title="最大化"></span>':"")+'<span i="close" class="dialog-close" title="关闭"></span></div></div><div i="content" class="dialog-content">'+this.__processUrl()+"</div></div>";return a},__center:function(){var a=this.__dialog,b=e.width(),c=e.height(),d=a.width(),f=a.height(),g=(b-d)/2,h=(c-f)/2;a.css({left:g,top:h})},__resize:function(){this.maxed&&this.__$("iframe").css({width:e.width()-2,height:e.height()-31})},__$:function(a){return this.__dialog.find("[i="+a+"]")},__maximize:function(){this.zIndexUp();var a=this.__dialog.offset().left,b=this.__dialog.offset().top;this.__dialog.data({left:a,top:b}),this.__dialog.animate({left:0,top:0},500),this.__$("iframe").animate({width:e.width()-2,height:e.height()-31},500),this.__$("maxres").removeClass("dialog-maximize").addClass("dialog-restore").attr("title","还原"),this.maxed=!0},__restore:function(){this.__dialog.animate({left:this.__dialog.data("left"),top:this.__dialog.data("top")},500),this.__$("iframe").animate({width:this.o.width,height:this.o.height},500),this.__$("maxres").removeClass("dialog-restore").addClass("dialog-maximize").attr("title","最大化"),this.maxed=!1},__openTask:function(){this.__task=$.ros.task({dialog:this,id:this.o.id,title:this.o.title,icon:this.o.icon})},__getDialogCount:function(){var a=0;return $.each(g,function(){a++}),a}},d.zIndex=1024;var i=function(a){return new d(a)};$.ros||($.ros={}),$.ros.dialog=i,c.exports={dialogList:g}}),define("build/ros/1.0.0/drag",[],function(){function a(a,b,c){this.lock=a,this.dragObj=b,this.controlObj=c||b,this.bind()}var b=$(document);a.prototype={down:function(a){var c=this;this.disX=a.clientX-this.controlObj.position().left,this.disY=a.clientY-this.controlObj.position().top,this.docWidth=b.width(),this.docHeight=b.height(),this.controlWidth=this.controlObj.outerWidth(),this.controlHeight=this.controlObj.outerHeight(),this.setCapture&&this.setCapture(),b.on("mousemove.drag",function(a){c.move(a)}),b.on("mouseup.drag",function(){c.up()})},move:function(a){var b=a.clientX-this.disX,c=a.clientY-this.disY;this.lock&&(0>b?b=0:b>this.docWidth-this.controlWidth&&(b=this.docWidth-this.controlWidth),0>c?c=0:c>this.docHeight-this.controlHeight&&(c=this.docHeight-this.controlHeight)),this.controlObj.css({left:b,top:c})},up:function(){b.off("mousemove.drag"),b.off("mouseup.drag"),this.dragObj.releaseCapture&&this.dragObj.releaseCapture()},bind:function(){var a=this;this.dragObj.on("mousedown",function(b){a.down(b),b.preventDefault()})}};var c=function(b,c,d){new a(b,c,d)};$.ros||($.ros={}),$.ros.drag=c}),define("build/ros/1.0.0/task",["build/ros/1.0.0/popupmenu","build/ros/1.0.0/user","build/ros/1.0.0/login"],function(a){var b=($(window),$(document),a("build/ros/1.0.0/popupmenu")),c={},d=function(a){this.active=!1,this.dialog=a.dialog,this.id=a.id,this.title=a.title,this.icon=a.icon,this.__init()};d.prototype={__init:function(){var a=this;this.__createTask(),this.__task.on("click",function(){a.dialog.toggle()}),this.__task.on("contextmenu",function(c){var d=b.taskmenu(a.dialog);return $(".contextmenu").hide(),b.show(c,d),!1})},__createTask:function(){var a='<div class="task-app-icon"><img src="'+this.icon+'"></div><div class="task-app-title">'+this.title+"</div>";this.__task=$("<li>").html(a).appendTo($("#task-content-inner")),c[this.id]=this,this.setActive()},setActive:function(){var a=this;$.each(c,function(b,c){a.id==b?(a.__task.addClass("active"),a.active=!0):c.cancelActive()})},cancelActive:function(){this.__task.removeClass("active"),this.active=!1},close:function(){delete c[this.id],this.__task.remove()}};var e=function(a){return new d(a)};$.ros||($.ros={}),$.ros.task=e});
